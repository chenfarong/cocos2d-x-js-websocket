{"version":3,"sources":["Network.js"],"names":["WebSocket","window","MozWebSocket","XNet","cc","Class","extends","Component","statics","_socket","ws_host","_netPros","Map","dispatchXNet","event","msg","listeners","slice","i","length","callback","target","connect","readyState","onopen","_onOpen","bind","evt","console","log","eventManager","dispatchCustomEvent","a","b","ListenerAdd","listenerList","Array","push","ListenerRemove","splice","DoRecvCmd","forEach","item","index","array"],"mappings":";;;;;;;;;AAAA,IAAIA,YAAYA,aAAaC,OAAOD,SAApB,IAAiCC,OAAOC,YAAxD;;AAMA,IAAIC,OAAOC,GAAGC,KAAH,CAAU;AACrBC,aAAUF,GAAGG,SADQ;AAErBC,aAAQ;AACJC,iBAAQ,EADJ;AAEJC,iBAAQ,6BAFJ;AAGJC,kBAAS,IAAIC,GAAJ,EAHL;;AAKJC,oBALI,wBAKSC,KALT,EAKeC,GALf,EAKmB;AACnB,gBAAG,KAAKJ,QAAL,CAAcG,KAAd,CAAH,EACA;AACI,oBAAIE,YAAU,KAAKL,QAAL,CAAcG,KAAd,EAAqBG,KAArB,EAAd;AACA,qBAAI,IAAIC,IAAE,CAAV,EAAYA,IAAEF,UAAUG,MAAxB,EAA+BD,GAA/B,EAAmC;AAC/BF,8BAAUE,CAAV,EAAaE,QAAb,CAAsBL,GAAtB,EAA0BC,UAAUE,CAAV,EAAaG,MAAvC;AACH;AACJ;AACJ,SAbG;;;AAeJC,iBAAQ,mBAAU;AACd,gBAAG,KAAKb,OAAL,CAAac,UAAb,IAAyB,CAA5B,EAA8B;;AAE1B,qBAAKd,OAAL,GAAa,IAAIT,SAAJ,CAAc,KAAKU,OAAnB,CAAb;AACA,qBAAKD,OAAL,CAAae,MAAb,GAAoB,KAAKC,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAApB;AACH;AACD,mBAAO,IAAP;AACH,SAtBG;;AAwBJD,iBAAQ,iBAASE,GAAT,EACR;AACIC,oBAAQC,GAAR,CAAY,eAAa,KAAKnB,OAA9B;AACA;AACA;AACA;AACA;AACD;AACAN,eAAG0B,YAAH,CAAgBC,mBAAhB,CAAoC,YAApC,EAAkD,EAACC,GAAE,CAAH,EAAKC,GAAE,CAAP,EAAlD;;AAIA;AACA;AACA9B,iBAAKU,YAAL,CAAkB,YAAlB,EAA+B,CAA/B;AAEF,SAxCG;;AA0CJqB,mBA1CI,uBA0CQpB,KA1CR,EA0CcM,QA1Cd,EA2CJ;AACI,gBAAG,CAACN,KAAD,IAAS,CAACM,QAAb,EAAuB;AACvB,gBAAIe,eAAa,KAAKxB,QAAL,CAAcG,KAAd,CAAjB;AACA,gBAAG,CAACqB,YAAJ,EAAkBA,eAAa,KAAKxB,QAAL,CAAcG,KAAd,IAAqB,IAAIsB,KAAJ,EAAlC;AAClB,iBAAI,IAAIlB,IAAE,CAAV,EAAYA,IAAEiB,aAAahB,MAA3B,EAAkCD,GAAlC,EACA;AACI,oBAAGiB,aAAajB,CAAb,KAAiBE,QAApB,EAA8B;AACjC;AACDe,yBAAaE,IAAb,CAAkBjB,QAAlB;AACH,SApDG;AAsDJkB,sBAtDI,0BAsDWxB,KAtDX,EAsDiBM,QAtDjB,EAsD0B;AAC1B,gBAAG,CAACN,KAAD,IAAS,CAACM,QAAb,EAAuB;AACvB,gBAAIe,eAAa,KAAKxB,QAAL,CAAcG,KAAd,CAAjB;AACA,gBAAGqB,YAAH,EAAgB;AACZ,qBAAI,IAAIjB,IAAE,CAAV,EAAYA,IAAEiB,aAAahB,MAA3B,EAAkCD,GAAlC,EACA;AACI,wBAAGiB,aAAajB,CAAb,KAAiBE,QAApB,EAA6B;AACzBe,qCAAaI,MAAb,CAAoBrB,CAApB,EAAsB,CAAtB;AACA;AACH;AACJ;AACJ;AACJ,SAlEG;AAsEJsB,iBAtEI,qBAsEMzB,GAtEN,EAuEJ;AACIJ,qBAAS8B,OAAT,CAAiB,UAAUC,IAAV,EAAgBC,KAAhB,EAAuBC,KAAvB,EAA8B;AAC3ChB,wBAAQC,GAAR,CAAYa,IAAZ,EAAkBC,KAAlB;AACH,aAFD;AAGH;AA3EG;;AAFa,CAAV,CAAX;;QAqFQxC,OAAAA","file":"Network.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var WebSocket = WebSocket || window.WebSocket || window.MozWebSocket;\n\n\n\n\t\n\nvar XNet = cc.Class ({\nextends : cc.Component,\nstatics:{\n    _socket:{},\n    ws_host:\"ws://192.168.1.40:8086/game\",\n    _netPros:new Map(),\n\n    dispatchXNet(event,msg){\n        if(this._netPros[event])\n        {\n            var listeners=this._netPros[event].slice();\n            for(var i=0;i<listeners.length;i++){\n                listeners[i].callback(msg,listeners[i].target);\n            }\n        }\n    },\n    \n    connect:function(){\n        if(this._socket.readyState!=1){\n\n            this._socket=new WebSocket(this.ws_host);\n            this._socket.onopen=this._onOpen.bind(this);\n        }\n        return this;\n    },\n\n    _onOpen:function(evt)\n    {\n        console.log(\"connected \"+this.ws_host);\n        //utils.OutObj(evt);\n        //var event = new cc.Event(this,\"Network\",true);\n        //event.setUserData(\"{...}\");\n        //cc.eventTarget.dispatchEvent(event);\n       // cc.EventTarget.dispatchEvent(\"adas\",\"123\",evt); \n       cc.eventManager.dispatchCustomEvent(\"XNetOpened\", {a:1,b:2});\n\n\n\n       //var event=new cc.EventCustom(\"XNetOpened\");\n       //cc.SystemEvent.dispatchCustomEvent(event);\n       XNet.dispatchXNet(\"XNetOpened\",1);\n\n    },\n\n    ListenerAdd(event,callback)\n    {\n        if(!event|| !callback) return;\n        var listenerList=this._netPros[event];\n        if(!listenerList) listenerList=this._netPros[event]=new Array();\n        for(var i=0;i<listenerList.length;i++)\n        {\n            if(listenerList[i]==callback) return;\n        }\n        listenerList.push(callback);\n    },\n\n    ListenerRemove(event,callback){\n        if(!event|| !callback) return;\n        var listenerList=this._netPros[event];\n        if(listenerList){\n            for(var i=0;i<listenerList.length;i++)\n            {\n                if(listenerList[i]==callback){ \n                    listenerList.splice(i,1);\n                    return;\n                }\n            }\n        }        \n    },\n\n\n\n    DoRecvCmd(msg)\n    {\n        _netPros.forEach(function (item, index, array) {\n            console.log(item, index);\n        });\n    },\n\n},\n\n\n\n});\n\nexport {XNet};"]}