{"version":3,"sources":["Network.js"],"names":["WebSocket","window","MozWebSocket","XNet","cc","Class","extends","Component","statics","_socket","ws_host","_netPros","Map","dispatchXNet","event","msg","listeners","slice","i","length","callback","target","connect","readyState","onopen","_onOpen","bind","onerror","_onError","onclose","_onClose","onmessage","_onMessage","console","log","xx_opcodes","XC_NET_CONNECTED","cmd","rc","error","XC_NET_DISCONNECTED","debug","str","data","JSON","parse","ListenerAdd","listenerList","Array","push","ListenerRemove","splice"],"mappings":"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","file":"Network.js","sourceRoot":"../../../../assets/Script","sourcesContent":["var WebSocket = WebSocket || window.WebSocket || window.MozWebSocket;\n\n\nimport {xx_errid,xx_opcodes} from './Opcodes';\n\t\n\nvar XNet = cc.Class ({\nextends : cc.Component,\nstatics:{\n    _socket:{},\n    ws_host:\"ws://test.9966886699.com:8086/game\",\n    _netPros:new Map(),\n\n    dispatchXNet(event,msg){\n        if(this._netPros[event])\n        {\n            var listeners=this._netPros[event].slice();\n            for(var i=0;i<listeners.length;i++){\n                listeners[i].callback(msg,listeners[i].target);\n            }\n        }\n    },\n    \n    connect:function()\n    {\n        if(this._socket.readyState!=1){\n\n            this._socket=new WebSocket(this.ws_host);\n            this._socket.onopen=this._onOpen.bind(this);\n            this._socket.onerror=this._onError.bind(this);\n            this._socket.onclose=this._onClose.bind(this);\n            this._socket.onmessage=this._onMessage.bind(this);\n        }\n        return this;\n    },\n\n\n\n    _onOpen:function(event)\n    {\n        console.log(\"connected \"+this.ws_host);\n        //utils.OutObj(evt);\n        //var event = new cc.Event(this,\"Network\",true);\n        //event.setUserData(\"{...}\");\n        //cc.eventTarget.dispatchEvent(event);\n       // cc.EventTarget.dispatchEvent(\"adas\",\"123\",evt); \n       \n       //\n       //cc.eventManager.dispatchCustomEvent(\"XNetOpened\", {a:1,b:2});\n\n\n\n       //var event=new cc.EventCustom(\"XNetOpened\");\n       //cc.SystemEvent.dispatchCustomEvent(event);\n       XNet.dispatchXNet(xx_opcodes.XC_NET_CONNECTED,{cmd:xx_opcodes.XC_NET_CONNECTED,rc:0});\n\n    },\n\n\n    _onError:function(event)\n    {\nconsole.error(\"WebSocket error observed:\", event);\n    },\n\n    _onClose:function(event)\n    {\n        console.log(\"WebSocket is closed now.\");\n        XNet.dispatchXNet(xx_opcodes.XC_NET_DISCONNECTED,{cmd:xx_opcodes.XC_NET_DISCONNECTED,rc:0});\n    },\n\n    _onMessage:function(event)\n    {\n        console.debug(\"WebSocket message received:\", event);\n        var str = event.data;\n        var msg = JSON.parse(str);\n        console.log(msg.cmd);\n    },\n\n\n    ListenerAdd(event,callback)\n    {\n        if(!event|| !callback) return;\n        var listenerList=this._netPros[event];\n        if(!listenerList) listenerList=this._netPros[event]=new Array();\n        for(var i=0;i<listenerList.length;i++)\n        {\n            if(listenerList[i]==callback) return;\n        }\n        listenerList.push(callback);\n    },\n\n    ListenerRemove(event,callback){\n        if(!event|| !callback) return;\n        var listenerList=this._netPros[event];\n        if(listenerList){\n            for(var i=0;i<listenerList.length;i++)\n            {\n                if(listenerList[i]==callback){ \n                    listenerList.splice(i,1);\n                    return;\n                }\n            }\n        }        \n    },\n\n\n\n\n},\n\n\n\n});\n\nexport {XNet};"]}